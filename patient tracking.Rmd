---
title: "Patients-Tracking"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(MCMCpack)
source("functions.R")
source("first_Iteration_function.R")
source("second_Iteration_functions.R")
```

## Generate a random matrix(n,m)

```{r}

psiLast<-NULL
psiNew <-NULL

mat<-matrix(sample(1:3,900,replace = T),90,10)

#mat

```

Omit 20% of matrix enteries


```{r}

indexSet <- selectRandomIndices(mat)
mat      <- omitEnteries(mat,indexSet)
```

***Create Transition Matrix (Psi)***

```{r}

psiNew<-createTransitionMatrix(mat)
#psiNew
```


For any given state (1,2,or 3) there might be 3 different range of probabilities.


```{r}

chanceMatrix<-obtainChanceMatrix(psiNew)
#chanceMatrix
```

## First iteration

### Predict proper state for missed data
1. Generate a random number
2. Use the ***chance matrix*** , to predict the proper state for the missed entery. 
3. Fill the NAs with proper state

```{r}

mat<-fillNA_First_Iteration(mat,chanceMatrix,indexSet )
```


## Next Iterations

1. Update a the Psi
2. Compare the new psi with the previous iteration psi
3. As long as the 2 last psi matrices are not converged do the following

    3.1. Fill the missed enteries

    3.2. Update the psi

    3.3. Back to 3

```{r}

psiLast <-psiNew
psiNew<-createTransitionMatrix(mat)
counter <- 1
printData(psiNew,psiLast,counter)


# 
# while(!isPSIsConverged(psiNew,psiLast)){     #if it is not cpnverged then continue until convergance
#   
#   mat <- fillNA_After_First_Iteration(mat,psiNew, indexSet )
#   
#   psiLast <- psiNew
#   psiNew  <- createTransitionMatrix(mat)
#   
#   printData(psiNew,psiLast,counter)
#   
#   print("Heyyyy")
# }

#mat
```




